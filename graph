#!/usr/bin/env python3

# Original Author: Aric Hagberg (hagberg@lanl.gov)
# Edited by Lucas Saldyt

import pandas

import matplotlib.image as mpimg
import matplotlib.pyplot as plt
import networkx as nx


alarmData = pandas.read_csv('alarm_strengths.csv')
physicalData = pandas.read_csv('physical_data.csv')
propagationData = pandas.read_csv('propagation.csv')

for index, row in alarmData.iterrows():
    G = nx.Graph()
    colorMap = []

    frame = int(row['Frame'])
    frameData = physicalData[(physicalData.frames == frame)]
    interactions = propagationData[(propagationData.frame == frame)]

    img = mpimg.imread('reference_frames/output_{}.png'.format(str(frame).rjust(4, '0')))
    plt.imshow(img)

    for i in range(1, 62):
        antData = frameData[(frameData.id == i)]
        x = float(antData['locX'])
        y = float(antData['locY'])
        G.add_node(i, pos=(x, y), label=str(i))
        alarm_strength = row['V' + str(i)]
        colorMap.append(alarm_strength)

    for index, row in interactions.iterrows():
        source, dest = row['AlarmedFrom'], row['Alarmed']
        G.add_edge(source, dest)

    pos = nx.get_node_attributes(G, 'pos')
    nx.draw(G, pos, node_color=colorMap, node_size=10, cmap=plt.cm.Reds)
    plt.savefig('frames/{}.png'.format(frame))
    plt.clf()

    print('{}/{}'.format(frame, alarmData.Frame.max()))
